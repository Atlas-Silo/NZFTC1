@page
@model NZFTC.Server.Pages.Payroll.PayrollSetupModel
@{
    ViewData["Title"] = "Payroll Setup";
    ViewData["PageTitle"] = "Payroll Setup";
}

@section Styles {
    <link rel="stylesheet" href="~/css/payroll.css">
}

<div class="layout">
    <partial name="_AdminSidebar" />

    <div class="main-content">
        <main class="content">
            <div class="page-header">
                <div class="page-title">
                    <h2>Payroll Configuration</h2>
                    <p>Configure payroll settings, tax rates, and deduction rules</p>
                </div>
                <button class="btn-save-all" onclick="saveAllSettings()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                    </svg>
                    Save All Changes
                </button>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('general')">
                    General Settings
                </button>
                <button class="tab" onclick="switchTab('tax')">
                    Tax Configuration
                </button>
                <button class="tab" onclick="switchTab('deductions')">
                    Deductions
                </button>
                <button class="tab" onclick="switchTab('banking')">
                    Banking & Payment
                </button>
            </div>

            <!-- Settings Container -->
            <div class="settings-container">
                <!-- General Settings Section -->
                <div class="setting-section">
                    <h3>Pay Period Configuration</h3>
                    <p class="description">Define the frequency and timing of payroll cycles</p>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Pay Frequency</label>
                            <select id="payFrequency">
                                <option value="weekly">Weekly</option>
                                <option value="fortnightly" selected>Fortnightly</option>
                                <option value="monthly">Monthly</option>
                                <option value="bimonthly">Bi-Monthly (Semi-Monthly)</option>
                            </select>
                            <p class="help-text">How often employees are paid</p>
                        </div>

                        <div class="form-group">
                            <label>Pay Day</label>
                            <select id="payDay">
                                <option value="monday">Monday</option>
                                <option value="tuesday">Tuesday</option>
                                <option value="wednesday">Wednesday</option>
                                <option value="thursday">Thursday</option>
                                <option value="friday" selected>Friday</option>
                            </select>
                            <p class="help-text">Day of the week for payment</p>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Current Pay Period Start</label>
                            <input type="date" id="periodStart" value="2025-11-01">
                            <p class="help-text">Start date of the current pay period</p>
                        </div>

                        <div class="form-group">
                            <label>Current Pay Period End</label>
                            <input type="date" id="periodEnd" value="2025-11-15">
                            <p class="help-text">End date of the current pay period</p>
                        </div>
                    </div>
                </div>

                <!-- Company Information -->
                <div class="setting-section">
                    <h3>Company Information</h3>
                    <p class="description">Company details for payroll and tax reporting</p>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Company Name</label>
                            <input type="text" id="companyName" value="New Zealand Fishing Trawling Company" placeholder="Company legal name">
                        </div>

                        <div class="form-group">
                            <label>IRD Number</label>
                            <input type="text" id="irdNumber" value="123-456-789" placeholder="000-000-000">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Contact Email</label>
                            <input type="email" id="contactEmail" value="payroll@nzftc.co.nz" placeholder="payroll@company.com">
                        </div>

                        <div class="form-group">
                            <label>Contact Phone</label>
                            <input type="text" id="contactPhone" value="+64 9 123 4567" placeholder="+64 9 XXX XXXX">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Company Address</label>
                        <input type="text" id="companyAddress" value="123 Harbour Drive, Auckland 1010, New Zealand" placeholder="Full company address">
                    </div>
                </div>

                <!-- Tax Settings -->
                <div class="setting-section">
                    <h3>PAYE Tax Configuration</h3>
                    <p class="description">Configure New Zealand PAYE tax brackets and rates</p>

                    <div class="alert alert-info">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                        </svg>
                        <div class="alert-content">
                            <strong>2025/2026 NZ Tax Rates</strong>
                            <p>These are the current IRD tax brackets. Update these values if tax rates change.</p>
                        </div>
                    </div>

                    <table class="tax-table">
                        <thead>
                            <tr>
                                <th>Income Range</th>
                                <th>Tax Rate (%)</th>
                                <th>Annual Bracket</th>
                            </tr>
                        </thead>
                        <tbody>
                            @* Backend: Loop through Model.TaxBrackets *@
                            <tr>
                                <td>Up to $14,000</td>
                                <td><input type="number" value="10.5" step="0.1" min="0" max="100"></td>
                                <td>$0 - $14,000</td>
                            </tr>
                            <tr>
                                <td>$14,001 to $48,000</td>
                                <td><input type="number" value="17.5" step="0.1" min="0" max="100"></td>
                                <td>$14,001 - $48,000</td>
                            </tr>
                            <tr>
                                <td>$48,001 to $70,000</td>
                                <td><input type="number" value="30" step="0.1" min="0" max="100"></td>
                                <td>$48,001 - $70,000</td>
                            </tr>
                            <tr>
                                <td>$70,001 to $180,000</td>
                                <td><input type="number" value="33" step="0.1" min="0" max="100"></td>
                                <td>$70,001 - $180,000</td>
                            </tr>
                            <tr>
                                <td>Over $180,000</td>
                                <td><input type="number" value="39" step="0.1" min="0" max="100"></td>
                                <td>$180,001+</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- KiwiSaver Settings -->
                <div class="setting-section">
                    <h3>KiwiSaver Configuration</h3>
                    <p class="description">Configure KiwiSaver contribution rates and settings</p>

                    <div class="form-row-3">
                        <div class="form-group">
                            <label>Employee Minimum Rate (%)</label>
                            <input type="number" id="employeeKiwiSaver" value="3" step="0.5" min="3" max="10">
                            <p class="help-text">Minimum 3%</p>
                        </div>

                        <div class="form-group">
                            <label>Employer Rate (%)</label>
                            <input type="number" id="employerKiwiSaver" value="3" step="0.5" min="3" max="10">
                            <p class="help-text">Minimum 3%</p>
                        </div>

                        <div class="form-group">
                            <label>ESCT Rate (%)</label>
                            <input type="number" id="esctRate" value="17.5" step="0.1" min="0" max="100">
                            <p class="help-text">Employer contribution tax</p>
                        </div>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-label">Automatic KiwiSaver Enrollment</div>
                            <div class="toggle-description">Automatically enroll new employees in KiwiSaver after 3 months</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Deductions -->
                <div class="setting-section">
                    <h3>Standard Deductions</h3>
                    <p class="description">Configure standard deductions applied to employee pay</p>

                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-label">Health Insurance</div>
                            <div class="toggle-description">Company-sponsored health insurance plan ($18.33 per pay period)</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-label">Student Loan Repayment</div>
                            <div class="toggle-description">Automatically deduct student loan repayments when applicable</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="form-group spacing-top">
                        <label>Student Loan Repayment Rate (%)</label>
                        <input type="number" id="studentLoanRate" value="12" step="1" min="0" max="100">
                        <p class="help-text">Standard rate is 12% of gross income above threshold</p>
                    </div>
                </div>

                <!-- Leave Settings -->
                <div class="setting-section">
                    <h3>Leave Accrual Settings</h3>
                    <p class="description">Configure how leave is accrued and calculated in payroll</p>

                    <div class="form-row-3">
                        <div class="form-group">
                            <label>Annual Leave (days/year)</label>
                            <input type="number" id="annualLeave" value="20" min="0" max="365">
                            <p class="help-text">Minimum 4 weeks (20 days)</p>
                        </div>

                        <div class="form-group">
                            <label>Sick Leave (days/year)</label>
                            <input type="number" id="sickLeave" value="10" min="0" max="365">
                            <p class="help-text">Minimum 10 days per year</p>
                        </div>

                        <div class="form-group">
                            <label>Bereavement Leave (days)</label>
                            <input type="number" id="bereavementLeave" value="5" min="0" max="30">
                            <p class="help-text">Per occurrence</p>
                        </div>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-label">Include Leave in Payroll Display</div>
                            <div class="toggle-description">Show current leave balances on pay slips</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Payment Notification Settings -->
                <div class="setting-section">
                    <h3>Payment Notifications</h3>
                    <p class="description">Configure employee payment notifications</p>

                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-label">Send Payment Notifications</div>
                            <div class="toggle-description">Email employees when their pay has been processed</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="setting-section">
                    <h3>Notifications & Alerts</h3>
                    <p class="description">Configure email notifications for payroll events</p>

                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-label">Payroll Due Reminders</div>
                            <div class="toggle-description">Send reminder 3 days before payroll deadline</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-label">Calculation Error Alerts</div>
                            <div class="toggle-description">Notify admins when payroll calculations detect anomalies</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-label">Monthly Reports</div>
                            <div class="toggle-description">Automatically email payroll summary reports monthly</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="form-group spacing-top">
                        <label>Notification Recipients</label>
                        <input type="email" id="notificationEmails" value="admin@nzftc.co.nz, payroll@nzftc.co.nz" placeholder="email1@company.com, email2@company.com">
                        <p class="help-text">Comma-separated list of email addresses</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveAllSettings()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                        </svg>
                        Save All Changes
                    </button>
                    <button class="btn btn-secondary" onclick="resetDefaults()">
                        Reset to Defaults
                    </button>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Success Message -->
<div class="success-message" id="successMessage">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 24px; height: 24px; fill: white;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span>Settings saved successfully!</span>
</div>
